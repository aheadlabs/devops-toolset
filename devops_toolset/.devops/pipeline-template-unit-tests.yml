steps:
  - task: CmdLine@2
    displayName: Unit test with pytest
    inputs:
      workingDirectory: '$(System.DefaultWorkingDirectory)/tests'
      script: |
        pytest --junitxml=".pytest/test-results.xml" --cov="." --cov-config=".coveragerc" --cov-report="xml" --cov-report="html"
  - task: PublishTestResults@2
    displayName: Publish unit test results
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: '$(System.DefaultWorkingDirectory)/tests/.pytest/test-results.xml'
  - task: PublishCodeCoverageResults@1
    displayName: Publish code coverage results
    inputs:
      codeCoverageTool: 'Cobertura'
      summaryFileLocation: '$(System.DefaultWorkingDirectory)/tests/.pytest/coverage.xml'
